Index: e-smith-mysql/e-smith-mysql.spec
diff -u e-smith-mysql/root/etc/e-smith/templates/var/service/mysqld/set.password:1.1 e-smith-mysql/root/etc/e-smith/templates/var/service/mysqld/set.password:1.2
--- e-smith-mysql/root/etc/e-smith/templates/var/service/mysqld/set.password:1.1	Sun Apr 10 13:11:16 2005
+++ e-smith-mysql/root/etc/e-smith/templates/var/service/mysqld/set.password	Mon Aug 29 17:00:01 2005
@@ -3,11 +3,8 @@
 
     my $pw = esmith::util::LdapPassword();
 
-    $OUT .= "#! /bin/sh\n";
-    $OUT .= "\n";
-    $OUT .= "/usr/libexec/mysqld --bootstrap --user=mysql --skip-grant-tables <<END\n";
     $OUT .= "use mysql;\n";
     $OUT .= "UPDATE user SET password=password('$pw') WHERE user='root';\n";
     $OUT .= "DELETE FROM user WHERE user='';\n";
-    $OUT .= "END\n";
+    $OUT .= "FLUSH PRIVILEGES\n";
 }
Index: e-smith-mysql/root/etc/e-smith/templates.metadata/var/service/mysqld/set.password
diff -u e-smith-mysql/root/etc/e-smith/templates.metadata/var/service/mysqld/set.password:1.1 e-smith-mysql/root/etc/e-smith/templates.metadata/var/service/mysqld/set.password:1.2
--- e-smith-mysql/root/etc/e-smith/templates.metadata/var/service/mysqld/set.password:1.1	Sun Apr 10 13:11:16 2005
+++ e-smith-mysql/root/etc/e-smith/templates.metadata/var/service/mysqld/set.password	Mon Aug 29 17:00:01 2005
@@ -1 +1 @@
-PERMS=0500
+PERMS=0400
Index: e-smith-mysql/root/var/service/mysqld/run
diff -u e-smith-mysql/root/var/service/mysqld/run:1.4 e-smith-mysql/root/var/service/mysqld/run:1.5
--- e-smith-mysql/root/var/service/mysqld/run:1.4	Mon Apr 11 18:46:19 2005
+++ e-smith-mysql/root/var/service/mysqld/run	Mon Aug 29 17:00:01 2005
@@ -4,10 +4,11 @@
 if [ ! -f /var/lib/mysql/mysql/user.frm ]
 then
     setuidgid mysql /usr/bin/mysql_install_db
-    ./set.password
-    if [ -f /home/e-smith/db/mysql/mysqld.dump ]
+    /usr/libexec/mysqld --bootstrap --user=mysql --skip-grant-tables < ./set.password
+    if [ -f /home/e-smith/db/mysql/mysql.dump ]
     then
-	mv /home/e-smith/db/mysql/mysqld.dump /etc/e-smith/sql/init/00_restore_dumped_dbs
+	mv /home/e-smith/db/mysql/mysql.dump /etc/e-smith/sql/init/00_restore_dumped_dbs.sql
+	cat ./set.password >> /etc/e-smith/sql/init/00_restore_dumped_dbs.sql
     fi
 fi
 
